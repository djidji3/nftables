flush ruleset
# FILTER-TABLE
table inet filter-table { 
    # INPUT-CHAIN
    chain input-chain { 
        type filter hook input priority filter; policy drop;
			iif "lo" counter packets 0 bytes 0 accept comment "lo KOMMUNIKACIO ENGEDVE" 
			ct state invalid counter packets 0 bytes 0 drop comment "INVALID CSOMAGOK ELDOBVA"
			tcp dport ssh ct state new meter ssh-input-limit size 65535 { tcp dport . ip saddr limit rate over 2/minute } counter packets 0 bytes 0 drop comment "UJ SSH KAPCSOLAT INDITASANAK LIMITALASA" 
			ct state established,related counter packets 52 bytes 3744 accept comment "MAR LETEZO KAPCSOLATOK ENGEDVE" 
            icmp type echo-request meter ping-limit size 65535 { ip saddr limit rate over 5/minute } counter packets 0 bytes 0 drop comment "PING KERESEK LIMITALASA" 
            icmp type echo-request counter packets 0 bytes 0 accept comment "PING SZAMOLVA ES ENGEDVE" 
            ip6 nexthdr ipv6-icmp icmpv6 type { nd-router-advert, nd-neighbor-solicit, nd-neighbor-advert } accept comment "icmpv6 ENGEDVE" 
            iif "enp0s8" ip saddr 10.10.10.0/24 counter packets 0 bytes 0 accept comment "INSIDE > ROUTER SZAMOLVA ES BEENGEDVE A ROUTERRE" 
            counter packets 0 bytes 0 drop comment "MINDEN EGYEB SZAMOLVA ES ELDOBVA" 
         }

    # FORWARD-CHAIN
    chain forward-chain {
        type filter hook forward priority filter; policy drop;
            ct state invalid counter packets 0 bytes 0 drop comment "INVALID CSOMAGOK SZAMOLVA ES ELDOBVA" 
            ct state established,related counter packets 1 bytes 139 accept comment "MAR LETEZO KAPCSOLATOK SZAMOLVA ES ENGEDVE" 
            oifname "enp0s3" jump forward2internet-chain comment "INTERNET FELE IRANYULO FORGALOM SZUROSZABALYAIHOZ UGRAS" 
            oifname "enp0s8" jump forward2lan-chain comment "LAN FELE IRANYULO FORGALOM SZUROSZABALYAIHOZ UGRAS" 
            oifname "enp0s9" jump forward2dmz-chain comment "DMZ FELE IRANYULO FORGALOM SZUROSZABALYAIHOZ UGRAS" 
            counter packets 3 bytes 184 drop comment "MINDEN EGYEB SZAMOLVA ES ELDOBVA" 
        }

    
    # FORWARD2LAN-CHAIN
    chain forward2lan-chain {
        
    }
    
    # FORWARD2DMZ-CHAIN
    chain forward2dmz-chain {
			tcp dport ssh ct state new meter ssh-dmz-limit size 65535 { tcp dport . ip saddr limit rate over 2/minute } counter packets 0 bytes 0 drop comment "UJ SSH KAPCSOLAT INDITASANAK LIMITALASA" 
            iifname "enp0s8" ip protocol tcp ip saddr 10.10.10.0/24 ip daddr 10.20.20.2 tcp dport { 143, 587 } ct state new counter packets 0 bytes 0 accept comment "INSIDE > DMZ  MAIL PROTOKOLLOK SZAMOLVA ES ENGEDVE" 
            iifname "enp0s8" ip saddr 10.10.10.2 ip daddr 10.20.20.0/24 tcp dport 22 ct state new counter packets 0 bytes 0 accept comment "INSIDE > DMZ UJ SSH KAPCSOLATOK SZAMOLVA ES ENGEDVE" 
            iifname "enp0s3" ip protocol tcp ip daddr 10.20.20.2 tcp dport { 25, 143 } counter packets 0 bytes 0 accept comment "NET > DMZ MAIL PROTOKOLLOK ENGEDVE" 
            iifname "enp0s3" ip daddr 10.20.20.2 tcp dport ssh counter packets 0 bytes 0 accept comment "NET > DMZ AZ SSH NATOLASAHOZ A MAIL SERVERRE ENGEDVE" 
        
    }
    
    # FORWARD2INTERNET-CHAIN
    chain forward2internet-chain {
            iif "enp0s9" ip saddr 10.20.20.0/24 counter packets 0 bytes 0 accept comment "DMZ > NET SZAMOLVA ES ENGEDVE" 
            iif "enp0s8" ip saddr 10.10.10.0/24 accept comment "INSIDE > NET ENGEDVE" 
        
    }

    # INPUT-CHAIN
    chain output-chain { 
        type filter hook output priority filter; policy accept;
        }
}

# NAT-TABLE
table ip nat-table {
    # POSTROUTING-CHAIN
    chain postrouting-chain { 
        type nat hook postrouting priority filter; policy accept;
            oifname "enp0s3" masquerade comment "NET IRANYBA MENO CSOMAGOK NAT-olva LESZNEK AZ ELSODLEGES PUBLIKUS IPCIMRE" 
        }

    # PREROUTING-CHAIN
    chain prerouting-chain {
        type nat hook prerouting priority filter; policy accept;
            iifname "enp0s3" tcp dport { 25, 143 } dnat to 10.20.20.2 comment "NET-rol ERKEZO LEVELEZO PROTOKOLLOK NATOLASA A MAIL SERVERRE"
            iifname "enp0s3" tcp dport 2222 dnat to 10.20.20.2:22 comment "NET-rol A 2222 PORTRA ERKEZO CSOMAGOK NATOLASA A MAIL SERVER 22 PORTJARA " 
        }
}
